import os
from random import randrange


cuadrantes = [[0, 1, 2], [3, 4, 5], [6, 7, 8]]
pjugador = "X"  # hay problemas en que si dejo esto en vacio, en la cuadrilla no se asigna nada en la pos que elige el jugador
pcompu = "O"
etapa = 0
cantX = 0
fila = 0
m = 0
ocupado = ["X", "O"]


def imprimirPantalla(cuadrantes):
    print((cuadrantes[0])[0], "|", (cuadrantes[0])[1], "|", (cuadrantes[0])[2])
    print("---------")
    print((cuadrantes[1])[0], "|", (cuadrantes[1])[1], "|", (cuadrantes[1])[2])
    print("---------")
    print((cuadrantes[2])[0], "|", (cuadrantes[2])[1], "|", (cuadrantes[2])[2])


def asignarpiezas():
    c = input('Seleccione su pieza (X o O) \n')
    pjugador = c


def ingreseNumero():
    print("ingrese posición")
    x = int(input("posicion x: "))
    y = int(input("posicion y: "))
    if (x<3 and x>=0 and y<3 and y>=0):
        if not(cuadrantes[x][y] in ocupado ):
            cuadrantes[x][y] = pjugador
        else:
            print('posicion invalida, la casilla esta ocupada')
            ingreseNumero()
    else:
        print('rango no valido')
        ingreseNumero()

def VueltaAtras(etapa, cuadrantes):
    for m in [0, 1, 2]:
        if (Valido(m, etapa, cuadrantes) == True):
            cuadrantes[m][etapa] = pcompu
            if etapa == 2:
                imprimirPantalla()
            else:
                VueltaAtras(etapa + 1, cuadrantes)


def Valido(m, etapa, cuadrantes):
    for i in [0, 1, 2]:
        if cuadrantes[m][i] == "X" or cuadrantes[m][i] == "O":
            return False

    for j in [0, 1, 2]:
        if cuadrantes[j][m] == "X" or cuadrantes[j][m] == "O":
            return False

    return True


def esquinaLibre(fila, etapa, cuadrantes):
    if not(cuadrantes[fila][etapa] in ocupado):
        return True
    else:
        etapa = etapa + 2
        if (etapa > 2):
            etapa = 0
            fila = fila + 2

        esquinaLibre(fila, etapa, cuadrantes)


def ganaJugador(cuadrantes, fila, etapa):
    # Control de filas
    if (cuadrantes[0][0] == cuadrantes[0][1]) or (cuadrantes[0][0] == cuadrantes[0][2]) or (
            cuadrantes[0][1] == cuadrantes[0][2]):
        return True
    if (cuadrantes[1][0] == cuadrantes[1][1]) or (cuadrantes[1][0] == cuadrantes[1][2]) or (
            cuadrantes[1][1] == cuadrantes[1][2]):
        return True
    if (cuadrantes[2][0] == cuadrantes[2][1]) or (cuadrantes[2][0] == cuadrantes[2][2]) or (
            cuadrantes[2][1] == cuadrantes[2][2]):
        return True


def taparJugada(etapa, cuadrantes, fila):
    if not(cuadrantes[fila][etapa] in ocupado):
        cuadrantes[fila][etapa] = pcompu
    else:
        etapa = etapa + 1
        if (etapa <= 2):
            taparJugada(etapa, cuadrantes, fila)


def juegaMaquina():
    if (ganaJugador(cuadrantes, fila, etapa) == True):
        taparJugada(etapa, cuadrantes, fila)
    else:
        if not(cuadrantes[1][1] in ocupado):  # Pregunta si esta libre el centro
            cuadrantes[1][1] = pcompu
            imprimirPantalla(cuadrantes)
        else:
            if (esquinaLibre(fila, etapa, cuadrantes) == True):  # Pregunta si alguna esquina está libre
                cuadrantes[fila][etapa] = pcompu
            else:
                VueltaAtras(etapa, cuadrantes)
                Valido(m, etapa, cuadrantes)

def victoria():
    f0 = cuadrantes[0][0] == cuadrantes[0][1] == cuadrantes[0][2]
    f1 = cuadrantes[1][0] == cuadrantes[1][1] == cuadrantes[1][2]
    f2 = cuadrantes[2][0] == cuadrantes[2][1] == cuadrantes[2][2]
    c0 = cuadrantes[0][0] == cuadrantes[1][0] == cuadrantes[2][0]
    c1 = cuadrantes[0][1] == cuadrantes[1][1] == cuadrantes[2][1]
    c2 = cuadrantes[0][2] == cuadrantes[1][2] == cuadrantes[2][2]
    d1 = cuadrantes[0][0] == cuadrantes[1][1] == cuadrantes[2][2]
    d2 = cuadrantes[0][2] == cuadrantes[1][1] == cuadrantes[2][0]
    if f0 or f1 or f2 or c0 or c1 or c2 or d1 or d2:
        return True
    else:
        return False



njugadas = 5
asignarpiezas()
imprimirPantalla(cuadrantes)
bandera = False

while njugadas > 0:
    ingreseNumero()
    os.system('cls')
    bandera = victoria()
    if bandera:
        print ("VICTORIA")
        break
    imprimirPantalla(cuadrantes)
    os.system('cls')
    print("JUEGA MAQUINA")
    juegaMaquina()
    njugadas = njugadas - 1
    imprimirPantalla(cuadrantes)

    bandera = victoria()
    if bandera:
        print("DERROTA")
        break

if njugadas == 0:
    print("EMPATE")

